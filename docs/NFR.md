# UGアプリプロジェクト 要件定義書

## 目次
- [1. 概要](#1-概要)
  - [1.1 プロジェクト概要](#11-プロジェクト概要)
  - [1.2 目的](#12-目的)
  - [1.3 用語定義](#13-用語定義)
  - [1.4 システム全体図](#14-システム全体図)
- [2. 業務要件](#2-業務要件)
  - [2.1 業務一覧](#21-業務一覧)
  - [2.2 業務フロー](#22-業務フロー)
- [3. 機能要件](#3-機能要件)
  - [3.1 機能一覧](#41-機能一覧)
  - [3.2 画面一覧](#42-画面一覧)
  - [3.3 出力ファイル一覧](#43-出力ファイル一覧)
  - [3.4 バッチ処理一覧](#44-バッチ処理一覧)
  - [3.5 外部連携](#45-外部連携)
- [4. 環境要件](#4-環境要件)
  - [4.1 クラウドサービス](#41-クラウドサービス)
  - [4.2 開発環境](#42-開発環境) 
  - [4.3 稼働環境](#43-稼働環境)
  - [4.4 外部システム](#44-外部システム)
- [5. 非機能要件](#5-非機能要件)
  - [5.1 可用性](#51-可用性)
  - [5.2 性能・拡張性](#52-性能拡張性)
  - [5.3 運用・保守性](#53-運用保守性)
  - [5.4 セキュリティ](#54-セキュリティ)

## 1. 概要
### 1.1 プロジェクト概要

### 1.2 目的

### 1.3 用語定義
### 1.4 システム全体図

## 2. 業務要件
### 2.1 業務一覧
### 2.2 業務フロー


## 3. 機能要件
### 3.1 機能一覧
### 3.2 画面一覧
#### 3.2.1 画面一覧
#### 3.2.2 画面遷移図
### 3.3 出力ファイル一覧
### 3.4 バッチ処理一覧
### 3.5 外部連携

## 4. 環境要件
### 4.1 クラウドサービス
##### バックエンド
- AWS
##### プッシュ通知
- 未確定
##### ソースコード管理
- GitHub
#### 4.1.1 主要なAWSサービス(未確定)
- Amazon ECS(Fargate): コンテナオーケストレーション
- Amazon S3: ストレージ
- Amazon Cognito: ユーザー管理
- Amazon RDS(Aurora Serverless v2): データベース
- Amazon CloudFront: エッジロケーション
- Application Load Balancer: 負荷分散
- AWS Lambda: バッチ処理
- AWS CodePipeline: CI/CD環境
### 4.2 開発環境
#### 4.2.1 バックエンド
- 言語: Python
- フレームワーク: Django
- データベース: PostgreSQL
#### 4.2.2 フロントエンド
##### ネイティブアプリ
- 言語: Dart
- フレームワーク: Flutter
##### Web
- 言語: HTML/CSS/Javascript
- フレームワーク: ***
#### 4.2.3 ソースコード管理
- git
- GitHub
#### 4.2.4 CI/CD環境
- AWS CodePipeline
### 4.3 稼働環境
##### Web
- 主要なブラウザ(Edge, Chrome, Safari)に対応
##### ネイティブアプリ
- iOSの主要バージョンに対応
- Androidの主要バージョンに対応

## 5. 非機能要件
### 5.1 可用性
#### 5.1.1 継続性
- **運用時間**: 24時間365日
- **目標復旧水準（業務停止時）**: 
  - **RPO(目標復旧地点)**: 障害発生時点
  - **RTO(目標復旧時間)**: 6時間以内
  - **RLO(目標復旧レベル)**: 顧客が関係する業務を優先的に復旧
- **目標復旧水準（大規模災害時）**: 1週間以内に再開
- **稼働率**: 99.9%（24時間365日運用の場合、年間許容ダウンタイム: 8.76時間）。ただし、メンテナンス・大規模災害時は除外
#### 5.1.2 耐障害性
- **AWS**:
  - **コンテナ(サーバー)**: ECSの冗長化
  - **ストレージ**: S3のバージョン管理を実施
  - **データベース**: 
    - 冗長化の実施
    - 自動バックアップの設定
  - **ネットワーク**: マルチAZ構成
- **アプリ**: ネットワーク切断時にも各機能でデータの整合性を保つ
#### 5.1.3 災害対策
- AWSサービスに依存
#### 5.1.4 回復性
- **インフラ**: AWSサービスに依存
- **データ**: 
  - ポイントインタイムリカバリ
  - スナップショットからの復元

### 5.2 性能・拡張性
#### 5.2.1 処理量
- **同時アクセス数**: 100リクエスト/秒
#### 5.2.2 性能目標
- **オンラインレスポンス**: 1秒以内
- **バッチレスポンス**: 再実行が可能な余裕を確保
#### 5.2.3 リソース拡張性
- **サーバー処理能力**: ECSのオートスケーリングの設定
- **データベース処理能力**: Aurora Serverless v2のオートスケーリングの設定

### 5.3 運用・保守性
#### 5.3.1 通常運用
- **運用時間**: 24時間365日
- **バックアップ**:
  - **ストレージ**: 30日以上前の非現行バージョンは1世代分を残して削除
  - **データベース**:
    - 自動バックアップの設定(業務時間外, バッチ処理時間外に設定)
    - 過去7日間のデータを保持
- **運用監視**:
  - **バックエンド**: CloudWatchでAWSサービスを監視
  - **フロントエンド(アプリ)**: 行動ログとクラッシュレポートを監視
#### 5.3.2 保守運用
- **パッチ適用**:
  - **適用対象**: セキュリティパッチおよびバグ修正を含むパッチ
  - **適用タイミング**: 業務時間外、バッチ処理時間外
- **バージョン管理**:
  - ソースコードのバージョン管理を徹底
  - ソフトウェアやライブラリ、プログラミング言語のサポート終了時にはアップデートを実施
  - iOSおよびAndroidの主要バージョンへの対応。主要バージョンの定義を行う。
  - OSがバージョンアップしたときの対応期間の策定をする。

#### 5.3.3 運用環境
- **開発環境の設置**: 本番環境と開発（検証）環境をAWS上で分離
- **マニュアル**: 通常運用時のマニュアルの用意

### 5.4 セキュリティ
#### 5.4.1 前提条件
- 社内規定およびATSG（オールトヨタ セキュリティ・ガイドライン）に準拠
#### 5.4.2 管理
- **AWS Config**: AWSリソースの構成変更履歴を管理
- **AWS Security Hub**: セキュリティ監視を一元管理
- **AWS Trusted Advisor**: セキュリティ最適化の支援
#### 5.4.3 脆弱性診断
- **Amazon Inspector**: 脆弱性の検出と管理
#### 5.4.4 アクセス・利用制限
- アプリはID/PASS認証またはOAuth 2.0
- 業務システムには多要素認証（MFA）を導入
- 全アカウントに対して最小権限の原則を徹底
#### 5.4.5 不正追跡・監視
- **AWS CloudTrail**: AWSリソースに対するAPI使用状況を記録および監視
- **Amazon GuardDuty**: 悪意のあるアクティビティや異常な動作のモニタリング、分析、対応
- **アクセスログの保存期間**: 1年
- 例外処理とエラーハンドリングを徹底
#### 5.4.6 ネットワーク対策
- **AWS Shield**: AWS標準機能。DDoS攻撃からのシステム保護
#### 5.4.7 マルウェア対策
- **Amazon GuardDuty**: [5.4.5](#545-不正追跡監視)を参照
#### 5.4.8 Web対策
- SSL/TLS必須
- AWS WAFの導入
- XSS(クロスサイトスクリプティング)対策
- CSRF(クロスサイトリクエストフォージェリ)対策
- SQLインジェクション対策
- 強制ブラウジング対策
- ディレクトリトラバーサル対策
- 不正アップロード制限
#### 5.4.9 調査
- **Amazon Detective**: セキュリティ調査の実施
#### 5.4.10 検証
- **アプリ**: 外部のQA会社への検証依頼（要検討）

### 5.5 移行性
#### 5.5.1 移行方式
- 未確定
#### 5.5.2 移行対象
##### システム
- 現行の長野トヨタポイントアプリシステム
- データ接続部分の開発
  - メンテナンスパック案内配信
  - 納車写真
  - CSアンケート
  - 後日付与
##### データ
- ポイントデータベース
- 納車写真